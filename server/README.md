# Серверная архитектура

## Структура проекта

```
server/
├── config.js              # Конфигурация сервера
├── index.js               # Основной файл сервера
├── controllers/           # Контроллеры
│   └── websocketController.js
├── services/              # Бизнес-логика
│   └── gameService.js
├── utils/                 # Утилиты
│   └── telegram.js
└── middleware/            # Middleware (пока пустая)
```

## Компоненты

### config.js
Централизованная конфигурация сервера:
- Настройки WebSocket
- Redis конфигурация
- Telegram токены
- Игровые параметры
- Каналы pub/sub

### services/gameService.js
Основная игровая логика:
- Управление состоянием игры
- Расчет коэффициентов в реальном времени
- Запуск и завершение игр
- Работа с историей сессий

### controllers/websocketController.js
Обработка WebSocket сообщений:
- Авторизация пользователей
- Обработка ставок и кэшаутов
- Управление чатом
- Синхронизация состояния

### utils/telegram.js
Утилиты для работы с Telegram:
- Валидация initData
- Извлечение данных пользователя
- DEV режим для тестирования

## Запуск

```bash
# Старый сервер
npm run ws

# Новый декомпозированный сервер
npm run ws-new
```

## Преимущества новой архитектуры

1. **Модульность** - каждый компонент отвечает за свою область
2. **Читаемость** - код разделен на логические блоки
3. **Тестируемость** - легко писать тесты для отдельных модулей
4. **Масштабируемость** - просто добавлять новые функции
5. **Поддержка** - легче находить и исправлять ошибки

## Принципы

- **Single Responsibility** - каждый класс отвечает за одну задачу
- **Dependency Injection** - зависимости передаются через конструктор
- **Configuration First** - все настройки в одном месте
- **Error Handling** - централизованная обработка ошибок 